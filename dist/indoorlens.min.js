(()=>{var oe=Object.defineProperty;var ot=(e,t)=>()=>(e&&(t=e(e=0)),t);var ie=(e,t)=>{for(var n in t)oe(e,n,{get:t[n],enumerable:!0})};var yt,ve,it,Bt,Rt,Ft,mt,St,Ot,ct,re,O,xt,Ie,Pt,Dt,gt,dt,wt=ot(()=>{yt=Object.freeze({Path:0,LineShape:1,SurfaceShape:2,Transition_NonWCHR:3,Transition_WCHR:4,Location:5}),ve=Object.freeze({0:"Path",1:"LineShape",2:"SurfaceShape",3:"Transition_NonWCHR",4:"Transition_WCHR",5:"Location"}),it=["#1e81b0","#c41837","#00b359"],Bt=class{constructor(t={}){this.position=new dt(t.position),this.associatedBranches=[...t.associatedBranchKeys??[]],this.guid=t.GUID??null}},Rt=class{constructor(t={}){this.key=t.key??0,this.groupId=t.groupId??"",this.layerId=t.layerId??"",this.nodeDistances=[...t.nodeDistances??[]],this.nodes=(t.nodes??[]).map(n=>new Bt(n))}},Ft=class{constructor(t={}){this.nodes=(t.Nodes??[]).map(n=>new dt({x:n.X??0,y:n.Y??0,z:n.Z??0})),this.startBranchKey=t.StartBranchKey??"",this.endBranchKey=t.EndBranchKey??"",this.pathLength=t.PathLength??"",this.fromId=t.FromMapLocationId??"",this.toId=t.ToMapLocationId??""}},mt=class{constructor(t={}){this.floors={};for(let[n,o]of Object.entries(t))this.floors[n]=new Ft(o)}},St=class{constructor(t={}){this.id=t.id??"",this.lineThickness=t.lineThickness??1;let n=t.color??{r:1,g:1,b:1,a:1};this.color=`rgba(${n.r*255},${n.g*255},${n.b*255},${n.a})`,this.enabled=!!t.enabled,this.renderType=Number(t.renderType)??yt.Path}},Ot=class{constructor(t={}){this.layers=(t.layers??[]).map(n=>new St(n)),this.id=t.id??"",this.groupName=t.groupName??"",this.roofHeight=t.roofHeight??0,this.enabled=!!t.enabled,this.opacity=t.opacity??1}},ct=class{constructor(t={}){this.branches=(t.branches??[]).reduce((n,o)=>{let s=new Rt(o);return n[s.key]=s,n},{}),this.groups=(t.groups??[]).map(n=>new Ot(n))}},re=Object.freeze({Custom:0,Entrance:1,Exit:2,Information:3,Restroom:4,Elevator:5,Escalator:6,Stairs:7,Parking:8,AccessibleRamp:9,ATM:10,FirstAid:11,Security:12,FireExtinguisher:13,EmergencyExit:14,LostAndFound:15,WaitingArea:16,ChargingStation:17,VendingMachine:18,Cafeteria:19,WaterFountain:20,SmokingArea:21,Playground:22,GreenSpace:23,Kiosk:24,Current_Kiosk:25}),O=Object.freeze({0:"Custom",1:"Entrance",2:"Exit",3:"Information",4:"Restroom",5:"Elevator",6:"Escalator",7:"Stairs",8:"Parking",9:"AccessibleRamp",10:"ATM",11:"FirstAid",12:"Security",13:"FireExtinguisher",14:"EmergencyExit",15:"LostAndFound",16:"WaitingArea",17:"ChargingStation",18:"VendingMachine",19:"Cafeteria",20:"WaterFountain",21:"SmokingArea",22:"Playground",23:"GreenSpace",24:"Kiosk",25:"Current_Kiosk"}),xt=Object.freeze({None:0,Icon:1,Label:2}),Ie=Object.freeze({0:"None",1:"Icon",2:"Label"}),Pt=class{constructor(t={}){this.branchKey=t.branchKey??0,this.distance=t.distance??0}},Dt=class{constructor(t={}){this.id=t.id??"",this.name=t.name??"",this.tags=t.tags??"",this.groupId=t.groupId??"",this.center=new dt(t.center),this.locationType=Number(t.locationType)??re.Custom,this.locationDisplayType=Number(t.locationDisplayType)??xt.Custom,this.locations=(t.locations??[]).map(n=>new Pt(n)),this.surfaceBranchKeys=[...t.surfaceBranchKeys??[]]}},gt=class{constructor(t={}){this.id=t.id??"",this.name=t.name??"",this.tags=t.tags??"",this.locations=(t.locations??[]).map(n=>new Dt(n))}},dt=class{constructor(t={}){this.x=t.x??t.X??0,this.y=t.y??t.Y??0,this.z=t.z??t.Z??0}}});function J({panX:e=g.x,panY:t=g.y,rotation:n,scale:o}={}){T=o,P=n,g={x:e,y:t},I()}function Xt(e){let t=!1,n=0,o=0;e.addEventListener("wheel",i=>{let r=i.deltaMode===1?15:1,d=performance.now(),l=e.getBoundingClientRect(),u=i.clientX-l.left-l.width/2-g.x,h=i.clientY-l.top-l.height/2-g.y;if(t&&!i.altKey&&Math.abs(i.deltaY)>Math.abs(i.deltaX)&&(t=!1,n=0),i.altKey&&(t=!0),t){i.preventDefault();let w=(i.deltaX||-i.deltaY)*.002*r;P+=w,n=w,o=d;let L=se(u,h,w);g.x+=u-L.x,g.y+=h-L.y,I();return}i.preventDefault();let m=Math.exp(-i.deltaY*.0015*r);T*=m,g.x-=u*(m-1),g.y-=h*(m-1),I()},{passive:!1});let s=[];e.addEventListener("touchstart",i=>{i.preventDefault(),s=[...i.touches]},{passive:!1}),e.addEventListener("touchmove",i=>{i.preventDefault();let[r,d]=s,[l,u]=i.touches;if(i.touches.length===1){let h=l.clientX-r.clientX,m=l.clientY-r.clientY;g.x+=h,g.y+=m}else if(i.touches.length===2){let h=(r.clientX+d.clientX)/2,m=(r.clientY+d.clientY)/2,w=(l.clientX+u.clientX)/2,L=(l.clientY+u.clientY)/2,z=Math.hypot(d.clientX-r.clientX,d.clientY-r.clientY),F=Math.hypot(u.clientX-l.clientX,u.clientY-l.clientY)/z;T*=F;let N=Math.atan2(d.clientY-r.clientY,d.clientX-r.clientX),V=Math.atan2(u.clientY-l.clientY,u.clientX-l.clientX)-N;P+=V,g.x+=w-h,g.y+=L-m}s=[...i.touches],I()},{passive:!1}),e.addEventListener("mousedown",i=>{i.preventDefault(),ut=!0,rt.x=i.clientX,rt.y=i.clientY}),window.addEventListener("mousemove",i=>{if(!ut)return;i.preventDefault();let r=i.clientX-rt.x,d=i.clientY-rt.y;g.x+=r,g.y+=d,rt.x=i.clientX,rt.y=i.clientY,I()}),window.addEventListener("mouseup",i=>{ut&&(ut=!1)}),e.addEventListener("mouseleave",i=>{ut=!1});function a(){if(requestAnimationFrame(a),!t)return;let r=(performance.now()-o)/1e3;if(n*=.94**(r*60),Math.abs(n)<1e-4){t=!1;return}P+=n,I()}a()}function se(e,t,n){let o=Math.cos(n),s=Math.sin(n);return{x:e*o-t*s,y:e*s+t*o}}var T,P,g,ut,rt,pt=ot(()=>{ft();T=10,P=0,g={x:0,y:0},ut=!1,rt={x:0,y:0}});function Nt(e,t){k=e,H=t,c=e.getContext("2d"),j=t.getContext("2d"),H.width=k.width,H.height=k.height,j.clearRect(0,0,H.width,H.height),Xt(k)}function I(){if(!W)return;c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,k.width,k.height);let e=window.devicePixelRatio||1,t=k.getBoundingClientRect(),n=(t.width/2+g.x)*e,o=(t.height/2+g.y)*e;c.translate(n,o),c.rotate(P),c.scale(T,T);for(let a=0;a<W.groups.length;a++){a==x?c.globalAlpha=1:a!==x&&a>x?c.globalAlpha=0:a!==x&&a<x&&(c.globalAlpha=.2);let i=W.groups[a];for(let r of i.layers)r.renderType===yt.SurfaceShape?fe(r,i):r.renderType===yt.LineShape&&he(r,i)}let s=ce(T);if(s>0){if(c.globalAlpha=s,M)for(let[r,d]of Object.entries(M.floors)){if(R(r)!=x)continue;let l=D(d.fromId),u=D(d.toId);(O[l.locationType]=="Stairs"||O[l.locationType]=="Elevator")&&vt(l,it[0]),(O[u.locationType]=="Stairs"||O[u.locationType]=="Elevator")&&vt(u,it[0])}let a=D(window.IndoorLens.fromid),i=D(window.IndoorLens.toid);if(a&&R(a.groupId)===x&&vt(a,it[2]),i&&R(i.groupId)===x&&vt(i,it[1]),M)for(let[r,d]of Object.entries(M.floors)){if(R(r)!=x)continue;let l=d.nodes;if(l.length>0){c.save(),c.lineWidth=2/T,c.strokeStyle=it[0],c.beginPath(),c.moveTo(l[0].x,l[0].z);for(let u=1;u<l.length;u++)c.lineTo(l[u].x,l[u].z);c.stroke(),c.restore()}}if(!U)return;for(let r of U.locations)if(R(r.groupId)===x){if(r.locationDisplayType===xt.Icon){let d=de(ue(r));d.loaded&&(c.save(),c.translate(r.center.x,r.center.z),c.rotate(-P),c.scale(1/T,1/T),c.drawImage(d.img,-36/2,-36/2,36,36),c.restore())}if(r.locationDisplayType===xt.Label){let d=r.name||O[r.locationType];c.save(),c.translate(r.center.x,r.center.z),c.rotate(-P),c.scale(1/T,1/T),c.font="20px Arial",c.textAlign="center",c.textBaseline="middle",c.fillStyle="#000",c.fillText(d,0,0),c.restore()}}c.restore()}}function jt(e,t,n){return e+(t-e)*n}function le(e,t,n){return{x:jt(e.x,t.x,n),y:jt(e.z,t.z,n)}}function $t(e){if(!Z||!M)return;let t=B.groups[x],n=M.floors[t.id];if(!n)return;let o=n.nodes;if(!o||o.length<2)return;bt==null&&(bt=e);let s=(e-bt)/1e3;bt=e,_=Math.min(_+ae*s,st);let a=0;for(;a<It.length&&Q[a+1]<_;)a++;let i=Q[a],r=It[a]||0,d=r>0?(_-i)/r:0,l=o[a],u=o[a+1],h=le(l,u,d);_==st==1&&(_=0),j.setTransform(1,0,0,1,0,0),j.clearRect(0,0,H.width,H.height);let m=k.getBoundingClientRect(),w=window.devicePixelRatio||1,L=(m.width/2+g.x)*w,z=(m.height/2+g.y)*w,X=h.x*T,F=h.y*T,N=Math.cos(P),K=Math.sin(P),V=X*N-F*K,et=X*K+F*N,p=V+L,b=et+z,y=6;j.beginPath(),j.arc(p,b,y,0,Math.PI*2),j.fillStyle="red",j.fill(),_<st&&(Z=requestAnimationFrame($t))}function ce(e){return e>=9?1:e<=7?0:(e-7)/2}function de(e){if(zt.has(e))return zt.get(e);let t=new Image;t.crossOrigin="anonymous",t.src=`https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/${e}`;let n={img:t,loaded:!1};return t.onload=()=>{n.loaded=!0,I()},zt.set(e,n),n}function ue(e){switch(O[e.locationType]){case"Exit":return"Exit.png";case"Entrance":return"Entrance.png";case"Restroom":return"Restroom.png";case"Elevator":return"Elevator.png";case"FireExtinguisher":return"FireExtinguisher.png";case"Kiosk":return"Kiosk.png";case"Information":return"Information.png";case"Current_Kiosk":return"KioskCurrent.png";case"MedicalKit":return"MedicalKit.png";case"Stairs":return"Stairs.png";case"Cafeteria":return"Cafeteria.png"}}function vt(e,t){if(e!=null)for(var n=0;n<e.surfaceBranchKeys.length;n++){var o=e.surfaceBranchKeys[n],s=B.branches[o];if(s==null)return;let a=s.nodes.map(i=>({x:i.position.x,y:i.position.z}));c.fillStyle=pe(t,.3),c.beginPath(),c.moveTo(a[0].x,a[0].y),a.slice(1).forEach(i=>c.lineTo(i.x,i.y)),c.closePath(),c.fill()}}function pe(e,t=1){let n=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),s=parseInt(e.slice(5,7),16);return`rgba(${n}, ${o}, ${s}, ${t})`}function fe(e,t){for(let n of Object.values(W.branches)){if(n.groupId!==t.id||n.layerId!==e.id)continue;let o=n.nodes.map(s=>({x:s.position.x,y:s.position.z}));c.fillStyle=e.color,c.beginPath(),c.moveTo(o[0].x,o[0].y),o.slice(1).forEach(s=>c.lineTo(s.x,s.y)),c.closePath(),c.fill()}}function he(e,t){for(let n of Object.values(W.branches)){if(n.groupId!==t.id||n.layerId!==e.id)continue;let o=n.nodes.map(s=>({x:s.position.x,y:s.position.z}));c.lineWidth=e.lineThickness,c.strokeStyle=e.color,c.beginPath(),c.moveTo(o[0].x,o[0].y),o.slice(1).forEach(s=>c.lineTo(s.x,s.y)),c.stroke()}}function R(e){if(B==null)return-1;for(var t=0;t<B.groups.length;t++){var n=B.groups[t];if(n.id==e)return t}return-1}function D(e){if(U==null)return null;for(var t=0;t<U.locations.length;t++){var n=U.locations[t];if(n.id===e)return n}return null}function Ht(e){U=new gt(e);let t=document.querySelector("#locationBadge span");t.textContent=U.name,I()}function qt(e){W=new ct(e),I()}function Wt(e){B=new ct(e),I()}function G(e){if(Ut(),e==null){M=null;return}setTimeout(()=>{M=new mt(e);var t=B.groups[x].id,n=M.floors[t];if(!n&&M.floors.length!=0)for(let[o,s]of Object.entries(M.floors)){tt(R(o));break}At(),Lt(),Z=requestAnimationFrame($t)},0)}function Lt(){if(!M)return;var e=B.groups[x].id,t=M.floors[e];if(!t)return;let n=[],o=D(t.fromId);if(!o?.surfaceBranchKeys?.length)return;for(let a=0;a<o.surfaceBranchKeys.length;a++){let i=o.surfaceBranchKeys[a],r=B?.branches[i];if(!r)return;n.push(...r.nodes.map(d=>({x:d.position.x,y:d.position.z})))}let s=D(t.toId);if(s?.surfaceBranchKeys?.length){for(let a=0;a<s.surfaceBranchKeys.length;a++){let i=s.surfaceBranchKeys[a],r=B?.branches[i];if(!r)return;n.push(...r.nodes.map(d=>({x:d.position.x,y:d.position.z})))}n.length&&ht(n,J)}}function Ut(){Z&&(cancelAnimationFrame(Z),Z=null),j.clearRect(0,0,H.width,H.height)}function me(){It=[],Q=[0],st=0;let e=B.groups[x],t=M.floors[e.id];if(!t){st=0;return}let n=t.nodes;for(let o=0;o<n.length-1;o++){let s=n[o+1].x-n[o].x,a=n[o+1].z-n[o].z,i=Math.hypot(s,a);It.push(i),Q.push(Q[o]+i)}st=Q[Q.length-1]||0,_=0}function ge(e,t){let n=Object.keys(e),o=n.indexOf(t);if(o>=0&&o+1<n.length)return n[o+1]}function At(){if(M==null)return;let e=document.getElementById("directionsBanner"),t=document.getElementById("directions");var n=B.groups[x],o=M.floors[n.id];if(!o){let L=Object.keys(M.floors);if(L.length!=0){let z=R(L[0]),X=`Please switch map to ${q(z)}.`;t.textContent=X,e.classList.remove("hidden")}else e.classList.add("hidden");return}var s=D(o.fromId),a=D(o.toId);if(s==null||a==null)return;let i=s.name?s.name:O[s.locationType],r=a.name?a.name:O[a.locationType],d="";window.IndoorLens.unit=="m"?d=o.pathLength.toFixed(1)+" m":d=(o.pathLength*3.28084).toFixed(1)+" feet";let l=M.floors,u=n.id,h=ge(l,u),m=R(h),w="";h!=null?w=`On ${q(x)}, from ${i} ${d} to ${r}. then to the ${q(m)}.`:w=`On ${q(x)}, from ${i} ${d} to ${r}.`,t.textContent=w,e.classList.remove("hidden"),me(),I()}function q(e){if(e==0)return"ground floor";if(e==1)return"first floor";if(e==2)return"second floor";if(e==3)return"third floor";if(e==4)return"fourth floor";if(e==5)return"fifth floor";if(e==6)return"sixth floor";if(e==7)return"seventh floor";if(e==8)return"eighth floor";if(e==9)return"ninth floor";if(e==10)return"tenth floor"}var k,H,c,j,Z,M,B,W,U,_,It,Q,st,ae,bt,zt,ft=ot(()=>{wt();pt();Et();k=null,H=null,c=null,j=null,Z=null;M=null,B=null,W=null,U=null;_=0,It=[],Q=[],st=0,ae=4;window.addEventListener("IndoorLens:floorChangeDelegate",e=>{Ut(),Z=requestAnimationFrame($t)});bt=null;zt=new Map;I()});async function Tt(e){let t=await fetch(e,{mode:"cors"});if(!t.ok)throw new Error(`${t.status}\xA0${t.statusText} \u2013 ${e}`);return t.json()}async function _t({onMap:e,onLayout:t,onPath:n}){let o=window.IndoorLens?.cfg?.mapid??"",s=document.getElementById("loadingOverlay"),a=document.getElementById("deadOverlay");s?.classList.remove("d-none"),a?.classList.add("d-none");try{let i=`${Mt}MapHandler?filename=${o}/map.txt&code=${Ct}`,r=`${Mt}LayoutHandler?filename=${o}/layout.txt&code=${Ct}`,d=`${Mt}PathHandler?filename=${o}/path.txt&code=${Ct}`,[l,u,h]=await Promise.all([Tt(i),Tt(r),Tt(d)]);e?.(l),t?.(u),n?.(h)}catch(i){console.error("loadInitialData error:",i),a?.classList.remove("d-none")}finally{s?.classList.add("d-none")}}async function at({onResult:e}){let t=window.IndoorLens.fromid?window.IndoorLens.fromid:"",n=window.IndoorLens.toid?window.IndoorLens.toid:"",o=window.IndoorLens.wchr?window.IndoorLens.wchr:!0;if(!t||!n)return;let s=window.IndoorLens?.cfg?.mapid??"",a=document.getElementById("loadingOverlay"),i=document.getElementById("deadOverlay");a?.classList.remove("hidden"),i?.classList.add("hidden");try{let r=`${Mt}PathFindingHandler?code=${Ct}&mapid=${encodeURIComponent(s)}&from=${encodeURIComponent(t)}&to=${encodeURIComponent(n)}&WCHR=${o}`,d=await Tt(r);e?.(d)}catch(r){console.error("PathFinding fetch error:",r),i?.classList.remove("hidden")}finally{a?.classList.add("hidden")}}var Mt,Ct,kt=ot(()=>{Mt="https://indoorlensmaps.azurewebsites.net/api/",Ct="Gh8s0sQm4Uy1U3bW-6MQ2M3U3PXxpPvEngTNcYmLvBPJAzFuc1df1w=="});function Gt(e){let t={newGroupIndex:e};window.dispatchEvent(new CustomEvent("IndoorLens:floorChangeDelegate",{detail:t}))}function Jt(){let e=document.getElementById("btnPlus"),t=document.getElementById("btnMinus"),n=document.getElementById("wchr"),o=document.getElementById("walk");Qt(),e.addEventListener("click",()=>{let p=Math.min(x+1,W.groups.length-1);Gt(p),tt(p),Lt()}),t.addEventListener("click",()=>{let p=Math.max(x-1,0);Gt(p),tt(p),Lt()}),o.addEventListener("click",()=>{window.IndoorLens.wchr=!0,n.style.display="flex",o.style.display="none",at({onResult:p=>{G(p)}})}),n.addEventListener("click",()=>{window.IndoorLens.wchr=!1,n.style.display="none",o.style.display="flex",at({onResult:p=>{G(p)}})});let s=document.getElementById("from"),a=document.getElementById("to"),i=document.getElementById("fromResultsList"),r=document.getElementById("toResultsList"),d=document.getElementById("btnFromClear"),l=document.getElementById("btnToClear"),u=document.getElementById("api"),h=document.getElementById("center"),m=document.getElementById("fullscreen"),w=!1;function L(){let p=m.querySelector("img");p&&(p.src=w?"https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/Minimize.png":"https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/Maximize.png")}s.addEventListener("input",()=>{d.disabled=s.value.trim()===""}),d.addEventListener("click",()=>{s.value="",d.disabled=!0,s.focus(),document.getElementById("directionsBanner").classList.add("hidden"),window.IndoorLens.fromid=null,G(null),I()}),a.addEventListener("input",()=>{l.disabled=a.value.trim()===""}),l.addEventListener("click",()=>{a.value="",l.disabled=!0,s.focus(),document.getElementById("directionsBanner").classList.add("hidden"),window.IndoorLens.toid=null,G(null),I()});let z=document.getElementById("linkDlg"),X=document.getElementById("apiUrl"),F=document.getElementById("copyBtn");F.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(X.value),F.textContent="Copied!",setTimeout(()=>F.textContent="Copy",1500),z.close()}catch{alert("Copy failed\u2014please copy manually.")}}),u.addEventListener("click",()=>{let p=window.IndoorLens.mapid?window.IndoorLens.mapid:"",b=window.IndoorLens.unit?window.IndoorLens.unit:"",y=window.IndoorLens.fromid?window.IndoorLens.fromid:"",v=window.IndoorLens.toid?window.IndoorLens.toid:"",E=window.IndoorLens.wchr?window.IndoorLens.wchr:!1,$=window.IndoorLens.apikey?window.IndoorLens.apikey:"",A=`https://www.indoorlens.com/api?mapid=${encodeURIComponent(p)}&unit=${encodeURIComponent(b)}&fromid=${encodeURIComponent(y)}&toid=${encodeURIComponent(v)}&wchr=${encodeURIComponent(E)}&apikey=${encodeURIComponent($)}`;X.value=A,z.showModal()}),h.addEventListener("click",()=>{ye(10)}),m.addEventListener("click",()=>{let p=document.getElementById("canvasroot");if(document.fullscreenElement){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();return}let b=p.requestFullscreen||p.webkitRequestFullscreen||p.msRequestFullscreen;b?b.call(p):(p.classList.toggle("force-fullscreen"),w=!w,L(),N())}),document.addEventListener("fullscreenchange",()=>{w=!!document.fullscreenElement,L(),N()});function N(){let p=document.getElementById("canvasroot"),b=p.clientWidth,y=p.clientHeight,v=window.devicePixelRatio||1;k.width=Math.floor(b*v),k.height=Math.floor(y*v),k.style.width=b+"px",k.style.height=y+"px",typeof canvasOverlay<"u"&&(canvasOverlay.width=Math.floor(b*v),canvasOverlay.height=Math.floor(y*v),canvasOverlay.style.width=b+"px",canvasOverlay.style.height=y+"px"),k.getContext("2d").setTransform(v,0,0,v,0,0),I()}function K(p){return p.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function V(p,b){let y=K(b.trim());if(!y)return[];let v=[],E=[],$=[];for(let f of p){let C=K(f.name??""),S=K(f.tags??""),Y=K(O[f.locationType]||"");C.includes(y)?v.push(f):S.includes(y)?E.push(f):O[f.locationType]!="Custom"&&Y.includes(y)&&$.push(f)}let A=(f,C)=>f.sort((S,Y)=>{let lt=K(C(S)),nt=K(C(Y));return lt.indexOf(y)-nt.indexOf(y)});return A(v,f=>f.name??""),A(E,f=>f.tags??""),A($,f=>O[f.locationType]??""),[...v,...E,...$]}function et(p,b){p.addEventListener("input",()=>{let y=p.value.trim().toLowerCase();if(!y){b.innerHTML="";return}let v=V(U.locations,y);b.innerHTML=v.map(E=>{let $=R(E.groupId),A=E.name?E.name:O[E.locationType];return`<li
            class="list-group-item list-group-item-action p-1"
            data-id="${E.id}"
          >
            ${A} on ${q($)}
          </li>`}).join("")}),b.addEventListener("click",y=>{let v=y.target.closest("li");if(!v)return;let E=v.dataset.id,$=v.textContent.trim();p.value=$;let A=p.id;if(b.innerHTML="",A=="from"?window.IndoorLens.fromid=E:A=="to"&&(window.IndoorLens.toid=E),window.IndoorLens.fromid&&window.IndoorLens.toid)at({onResult:f=>{G(f)}});else{let f=D(E),C=[];if(!f?.surfaceBranchKeys?.length)return;for(let Y=0;Y<f.surfaceBranchKeys.length;Y++){let lt=f.surfaceBranchKeys[Y],nt=B?.branches[lt];if(!nt)return;C.push(...nt.nodes.map(Yt=>({x:Yt.position.x,y:Yt.position.z})))}if(!C.length)return;let S=R(f.groupId);tt(S),ht(C,J)}I()})}et(s,i),et(a,r),L()}function tt(e){W&&(x=e,Qt(),At(),I())}function Qt(){let e=document.getElementById("groupLabel");e.textContent=x}function ye(e=6){J({panX:0,panY:0,rotation:0,scale:e})}function ht(e,t,{padding:n=150,duration:o=500,minScale:s=.5,maxScale:a=100}={}){let i=window.devicePixelRatio||1,r=Math.cos(P),d=Math.sin(P),l=1/0,u=1/0,h=-1/0,m=-1/0;e.forEach(({x:f,y:C})=>{let S=r*f-d*C,Y=d*f+r*C;l=Math.min(l,S),u=Math.min(u,Y),h=Math.max(h,S),m=Math.max(m,Y)});let w=Math.max(h-l,1e-6),L=Math.max(m-u,1e-6),z=k.width-n*i*2,X=k.height-n*i*2,F=Math.min(z/w,X/L);F=Math.max(s,Math.min(a,F));let N=(l+h)/2,K=(u+m)/2,V=-(F/i)*N,et=-(F/i)*K,p=T,b=g.x,y=g.y,v=performance.now(),E=f=>f<.5?2*f*f:-1+(4-2*f)*f,$=(f,C,S)=>f+(C-f)*S;function A(f){let C=Math.min((f-v)/o,1),S=E(C),Y=$(p,F,S),lt=$(b,V,S),nt=$(y,et,S);t({panX:lt,panY:nt,rotation:P,scale:Y}),C<1&&requestAnimationFrame(A)}requestAnimationFrame(A)}var Vt,x,Et=ot(()=>{wt();ft();kt();pt();ft();Vt=document.createElement("style");Vt.innerHTML=`
#canvasroot.force-fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
}
`;document.head.appendChild(Vt);x=0});var ee={};ie(ee,{IndoorLensWidget:()=>Kt,buildIndoorLensDOM:()=>te});function xe(){let e=window.IndoorLens.fromid,t=window.IndoorLens.toid,n=window.IndoorLens.wchr==="true",o=window.IndoorLens.isapi==="true",s=document.getElementById("from"),a=document.getElementById("to"),i=document.getElementById("wchr"),r=document.getElementById("walk"),d=document.getElementById("api");if(o?d.style.display="none":d.style.display="flex",n?(i.style.display="flex",r.style.display="none"):(i.style.display="none",r.style.display="flex"),e){let l=D(e);s.value=`${l.name} on ${q(R(l.groupId))}`,s.disabled=!0}if(t){let l=D(t);a.value=`${l.name} on ${q(R(l.groupId))}`,a.disabled=!0}if(e&&t)at({fromId:e,toId:t,WCHR:n,onResult:l=>{G(l)}});else{if(!t)return;let l=D(t),u=[];if(!l?.surfaceBranchKeys?.length)return;for(let m=0;m<l.surfaceBranchKeys.length;m++){let w=l.surfaceBranchKeys[m],L=B?.branches[w];if(!L)return;u.push(...L.nodes.map(z=>({x:z.position.x,y:z.position.z})))}if(!u.length)return;let h=R(l.groupId);tt(h),ht(u,J)}}function Zt(){if(document.getElementById("indoorlens\u2011css"))return;let e=document.createElement("style");e.id="indoorlens\u2011css",e.textContent=`
  /* ---------- page\u2011level layout ------------------------------------------------ */
  .page-container{min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;margin:0;}

    .canvas-overlay{position:absolute; top:0; left:0; z-index:2; pointer-events:none;}
  .canvas-wrapper{position:relative;display:inline-block;html, font-family: 'Roboto', sans-serif;}
  .canvas-border{border:1px solid #343a40;background:#eee;display:block;}

  .loading-overlay{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;background:#fff;z-index:20;}
  .loading-overlay.hidden{display:none;}
  @keyframes spin360{to{transform:rotate(360deg);}}
  .spin{width:64px;height:64px;animation:spin360 1.2s linear infinite;}

 

  .top-bar{display:flex;   flex-wrap: wrap;   gap: .5rem;align-items:stretch;position:absolute;top:0;left:0;width:100%;z-index:10;padding:4px;gap:4px;box-sizing:border-box;}

  .flex-col{flex:1 1 0;position:relative;}
  .input-group{display:flex;align-items:stretch;font-size:.875rem;margin-bottom:0;}
  .input-tag{background:#333;border:1px solid #555;border-right:0;padding:.375rem .5rem;display:flex;align-items:center;color:#eee;}
  .input-field{flex:1 1 0;border:1px solid #555;background:#222;color:#fff;padding:.375rem .5rem;font-size:16px;}
  .input-clear{background:#444;color:#fff;border:none;width:2rem;display:flex;align-items:center;justify-content:center;cursor:pointer; border-top-right-radius:0.25rem; border-bottom-right-radius:0.25rem;border-top-left-radius:0; border-bottom-left-radius:0;}
  .input-clear:disabled{opacity:.4;cursor:default;}

  .results-list{position:absolute;left:0;right:0;top:100%;margin-top:.25rem;z-index:11;max-height:200px;overflow-y:auto;list-style:none;padding:0;background:#222; border:1px solid #555;color:#fff;text-align:left;}
  .results-list li{padding:.25rem .5rem;cursor:pointer;color:inherit;text-align:left;}
  .results-list li:hover{background:#3a3a3a;}
  .results-list:empty{display:none;}

 
/* Mobile stack: each flex-col (From/To) gets its own row */
@media (max-width: 768px) {
  .top-bar {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 0.5rem;          /* space between rows */
  }

  .flex-col {
    flex: none;           /* cancel the default flex:1 1 0 */
    width: 100%;          /* full width of the .top-bar */
  }

  /* keep the label/field/button in one line */
  .input-group {
    display: flex;
    flex-wrap: nowrap !important;
   align-items: stretch;  /* children (including .input-clear) fill the group height */
  }
  .input-field {
    flex: 1 1 auto;
    min-width: 0;
  }
 
  .input-clear {
    flex: 0 0 auto;
  }

  .input-tag {
  flex: 0 0 4rem;      /* never shrink or grow, always 4rem wide */
  min-width: 4rem;     /* ensures the same baseline width */
  text-align: center;  /* center the text within the label */
  }

 
  .input-clear {
    align-self: stretch;   /* full height */
    border-top-right-radius: 0.25rem;
    border-bottom-right-radius: 0.25rem;
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }

 
  .brand-badge span,
    .location-badge   span {
      font-size: 10px;
      align-self: flex-end;
    }

    .top-bar,
    #groupPanel,
    .accessibility-btn {
      transform: scale(0.8);
      transform-origin: top left;
    }
    
    /* Since scale shrinks the box but not the space it occupies,
      you may need to pull it back up/left a bit: */
    .top-bar   {     width: calc(100% / 0.8);     }
    #groupPanel { margin-right: -0.2rem; }
}
  .brand-badge,
  .location-badge {
    position: absolute;
    bottom: 7px;
    display: flex; align-items: center;
    font-family: 'Roboto', sans-serif;
  }

  .brand-badge {left: 7px;}
  .location-badge {right: 7px;}

  .brand-badge img,
  .location-badge img {
    width: 20px;
    height: 20px;
 
  }
 
   .brand-badge span,
  .location-badge   span {
 
  color: #0c0c0c;
  font-family: 'Roboto', sans-serif;
   align-self: flex-end;
}

   #otherPanel{position:absolute;right:7px;
   top:30% ;
   transform:translateY(-50%);display:flex;flex-direction:column;align-items:center;background:rgba(0,0,0,.2);border:2px solid #ffffff33;border-radius:.3rem; }
  #floorPanel{position:absolute;right:7px;top:60%;transform:translateY(-50%);display:flex;flex-direction:column;align-items:center;background:rgba(0,0,0,.2);border:2px solid #ffffff33;border-radius:.3rem; }
  #floorPanel span{color:#fff;font-weight:600; }
  .panel-btn{width:28px;height:28px;padding:0;margin-bottom:.25rem;background:#444;border:1px solid #555;font-size:1rem;line-height:1;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#fff;border-radius:.25rem;}
  .panel-btn:last-child{margin-bottom:0;}
  .hidden{display:none;}


/* Container sits just under the top-bar */
.directions-banner {
  width: 100%;
  box-sizing: border-box;
  padding: 0.5rem 1rem;
  background: rgba(0, 0, 0, 0.75);
  color: #fff;
  font-family: 'Roboto', sans-serif;
  font-size: 0.875rem;
  text-align: center;
   z-index: 15;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

/* Hide by default */
.directions-banner.hidden {
  opacity: 0;
  visibility: hidden;
}

/* Show by removing \u201Chidden\u201D */
.directions-banner:not(.hidden) {
  opacity: 1;
  visibility: visible;
}

 dialog {border: none; border-radius: 8px; padding: 1.5rem; box-shadow: 0 4px 12px #0003;   width: 50%;max-width: 600px;margin: auto;  }
.api-input {width: 100%; margin: .75rem 0 1rem; padding: .5rem; font-family: monospace;}
.btn-row { display: flex; gap: .5rem; justify-content: flex-end; }
`,document.head.appendChild(e)}function te(e,{width:t=1e3,height:n=600}={}){Zt();let o=document.createElement("div");o.className="canvas-wrapper",o.id="canvasroot";let s=typeof t=="number"?`${t}px`:t,a=typeof n=="number"?`${n}px`:n;o.style.width=s,o.style.height=a,e.appendChild(o);let i=document.createElement("canvas");i.id="canvasMain",i.className="canvas-border",i.style.width="100%",i.style.height="100%",o.appendChild(i),requestAnimationFrame(()=>{let u=i.getBoundingClientRect(),h=window.devicePixelRatio||1;i.width=Math.round(u.width*h),i.height=Math.round(u.height*h),i.getContext("2d").scale(h,h)});let r=document.createElement("canvas");r.id="canvasOverlay",r.className="canvas-overlay",r.style.width="100%",r.style.height="100%",o.appendChild(r),requestAnimationFrame(()=>{let u=r.getBoundingClientRect(),h=window.devicePixelRatio||1;r.width=Math.round(u.width*h),r.height=Math.round(u.height*h),r.getContext("2d").scale(h,h)}),o.insertAdjacentHTML("beforeend",`
    <div id="loadingOverlay" class="loading-overlay hidden">
      <img src="https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/Loader.png" class="spin" alt="loading"/>
    </div>
    <div id="deadOverlay" class="loading-overlay hidden">
      <img src="https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/Dead.png" alt="dead"/>
    </div>`);let d=o.querySelector("#loadingOverlay"),l=o.querySelector("#deadOverlay");return o.insertAdjacentHTML("beforeend",`
    <div class="top-bar">
      <div class="flex-col">
        <div class="input-group">
          <span class="input-tag">From</span>
          <input id="from" type="text" class="input-field" placeholder="Search from\u2026" />
          <button id="btnFromClear" class="input-clear" disabled>&times;</button>
        </div>
        <ul id="fromResultsList" class="results-list"></ul>
      </div>

      <div class="flex-col">
        <div class="input-group">
          <span class="input-tag">To</span>
          <input id="to" type="text" class="input-field" placeholder="Search to\u2026" />
          <button id="btnToClear" class="input-clear"  disabled>&times;</button>
        </div>
        <ul id="toResultsList" class="results-list"></ul>
      </div>
       <div id="directionsBanner" class="directions-banner hidden">
  <p id="directions">Turn right at the escalator, then go straight for 30 m.</p>
</div> 
    </div>  

    `),o.insertAdjacentHTML("beforeend",`
    <div class="brand-badge">
      <img src="https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/IconDark.png" alt="IndoorLens icon" />
      <span>IndoorLens.com</span>
    </div>

    <div id="locationBadge" class="location-badge"  >
      <span></span>
      <img src="https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/LocationPin.png" alt="IndoorLens location" />
    </div>
`),o.insertAdjacentHTML("beforeend",`
    <div id="floorPanel">
      <button id="btnPlus" class="panel-btn">+</button>
      <span id="groupLabel">0</span>
      <button id="btnMinus" class="panel-btn">\u2212</button>
    </div>

   <div id="otherPanel">
      <button id= "fullscreen" class="panel-btn">
            <img src="https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/Maximize.png" alt="fullscreen link" width="16" height="16">
      </button>
      <button id= "center" class="panel-btn">
            <img src="https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/Center.png" alt="fullscreen link" width="16" height="16">
      </button>

      <button id=  "wchr" class="panel-btn hidden">
           <img src="https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/Wchr.png" alt="Wheelchair" width="16" height="16">
      </button>
      <button id= "walk" class="panel-btn">
            <img src="https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/Walk.png" alt="Walk" width="16" height="16">
      </button>

      <button id= "api" class="panel-btn">
            <img src="https://cdn.jsdelivr.net/gh/elseforty/IndoorLens/LocationIcons/Api.png" alt="API link" width="16" height="16">
      </button>
    </div>`),o.insertAdjacentHTML("beforeend",`
    <dialog id="linkDlg">
      <form method="dialog">                 <!-- lets \u201CEsc\u201D or \u2715 close it -->
        <h3>API Endpoint</h3>

        <!-- the link text (editable via JS) -->
        <input id="apiUrl" type="text" readonly class="api-input">

        <div class="btn-row">
          <button id="copyBtn" type="button">Copy</button>
          <button type="submit">Close</button>
        </div>
      </form>
    </dialog>
    `),{canvasMain:i,canvasOverlay:r,loadingOverlay:d,deadOverlay:l}}var Kt,ne=ot(()=>{kt();Et();ft();pt();Kt=class{constructor(t,n){this.root=t,this.opts=n,Zt();let o=te(this.root,{width:this.opts.width,height:this.opts.height});this.loadingOverlay=o.loadingOverlay,this.deadOverlay=o.deadOverlay,Nt(o.canvasMain,o.canvasOverlay),Jt(this.root),this.initLogic()}initLogic(){this.loadingOverlay?.classList.remove("hidden"),_t({onMap:t=>Ht(t),onLayout:t=>qt(t),onPath:t=>Wt(t)}).finally(()=>{this.loadingOverlay?.classList.add("hidden"),xe()})}}});wt();Et();kt();pt();function we(e={}){let t=Object.assign({},e);window.IndoorLens=window.IndoorLens||{},window.IndoorLens.cfg={target:t.target,mapid:t.mapid,apikey:t.apikey,unit:t.unit,fromid:t.fromid,toid:t.toid,wchr:t.wchr,isapi:t.isapi},window.IndoorLens.mapid=t.mapid,window.IndoorLens.fromid=t.fromid,window.IndoorLens.toid=t.toid,window.IndoorLens.apikey=t.apikey,window.IndoorLens.unit=t.unit,window.IndoorLens.wchr=t.wchr,window.IndoorLens.isapi=t.isapi;let n=typeof t.target=="string"?document.querySelector(t.target):t.target;if(!n)throw new Error("IndoorLens: target element not found");Promise.resolve().then(()=>(ne(),ee)).then(({IndoorLensWidget:o})=>{let s=new o(n,t);window.IndoorLensWidget=s})}typeof window<"u"&&(window.IndoorLens=window.IndoorLens||{},window.IndoorLens.init=we);})();
//# sourceMappingURL=indoorlens.min.js.map
